# TERACO予約システム 作業履歴

## 📅 2026-01-29 作業内容

### 1. 予約表示問題の改善（完了）
- **症状**: 既存ユーザーが「予約を確認する」を押しても情報が表示されない。
- **原因**: 
  - フロントエンドが `ev.iso` を参照していたが、バックエンドは `ev.start` を返していた。
  - サーバーから取得した最新の予約状況（人数など）が `state.slots` に再反映されていなかった。
- **対策**:
  - `pwa-reserve/main.js` の `loadOverview` 内でプロパティ名を `ev.start` に統一。
  - サーバーレスポンス受領時に最新の状態に更新するよう修正。

### 2. 予約人数のカウントロジック修正（完了）
- **内容**: 
  - 1つのイベントに複数人が予約している場合、イベント数ではなく「説明欄の名前の行数」をカウントするように `pwa-reserve/gas/Code.gs` を修正。

### 3. メール通知機能の強化と安定化（完了）
- **管理者通知**: 新規予約・取消のすべてを `CONFIG.TEACHER_EMAIL` 宛に送信。ログインユーザーの場合はそのメールアドレスも本文に記載。
- **ユーザー通知**: Googleログイン済みユーザーにのみ、詳細な予約完了・取消メールを送信。
- **安定化**: 
  - メールの差出人名称を設定。
  - エラーハンドリングを追加し、送信失敗時にログを残すよう改善。

### 5. Googleカレンダー連携の自動化とノイズ削減（完了）
- **自動承諾**: ユーザーがカレンダー追加を選択した際、招待メールを送らず、かつ最初からステータスを「出席（承諾済み）」にセット。
- **通知抑制**: ユーザーが「はい」を押す手間を省き、管理者への「出席の回答」メール通知を完全にブロック。
- **UI調整**: ユーザーに不要な不安を与えないよう「招待メールが届きます」という文言を削除。

---

## 🛠 現在の構成
- **Frontend**: GitHub Pages (`pwa-reserve/main.js`, `pwa-reserve/index.html`) - API v33 連携済み
- **Backend**: Google Apps Script (v33 自動承諾・通知抑制版)
- **Database**: Google Calendar
