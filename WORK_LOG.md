# TERACO予約システム 作業履歴

## 📅 2026-01-29 作業内容

### 1. 予約表示問題の改善（完了）
- **症状**: 既存ユーザーが「予約を確認する」を押しても情報が表示されない。
- **原因**: 
  - フロントエンドが `ev.iso` を参照していたが、バックエンドは `ev.start` を返していた。
  - サーバーから取得した最新の予約状況（人数など）が `state.slots` に再反映されていなかった。
- **対策**:
  - `pwa-reserve/main.js` の `loadOverview` 内でプロパティ名を `ev.start` に統一。
  - サーバーレスポンス受領時に最新の状態に更新するよう修正。

### 2. 予約人数のカウントロジック修正（完了）
- **内容**: 
  - 1つのイベントに複数人が予約している場合、イベント数ではなく「説明欄の名前の行数」をカウントするように `pwa-reserve/gas/Code.gs` を修正。

### 3. メール通知機能の強化と安定化（完了）
- **管理者通知**: 新規予約・取消のすべてを `CONFIG.TEACHER_EMAIL` 宛に送信。ログインユーザーの場合はそのメールアドレスも本文に記載。
- **ユーザー通知**: Googleログイン済みユーザーにのみ、詳細な予約完了・取消メールを送信。
- **安定化**: 
  - メールの差出人名称を設定。
  - エラーハンドリングを追加し、送信失敗時にログを残すよう改善。

### 4. 構成の復元とURL維持（完了）
- **内容**: 
  - 誤って削除したルートディレクトリの他ファイルを復元。
  - アプリを `pwa-reserve/` フォルダ内に配置し、従来のURL（.../pwa-reserve/）を維持。

---

## 🛠 現在の構成
- **Frontend**: GitHub Pages (`pwa-reserve/main.js`, `pwa-reserve/index.html`)
- **Backend**: Google Apps Script (最新デプロイ)
- **Database**: Google Calendar
