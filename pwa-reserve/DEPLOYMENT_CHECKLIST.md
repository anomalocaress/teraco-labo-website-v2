# TERACO予約アプリ デプロイチェックリスト

## 📝 デプロイ前の確認事項

### 1. Google Apps Script (GAS) の設定

#### Code.gs の設定確認
```javascript
const CONFIG = {
  TEACHER_EMAIL: 'fujisaki@teraco-labo.com',  // ✅ 管理者メールアドレス
  CALENDAR_ID: 'primary',                      // ✅ または特定のカレンダーID
  // ...
};
```

#### デプロイ手順
1. Google Apps Script エディタを開く
2. `Code.gs` の内容を貼り付け
3. 「デプロイ」→「新しいデプロイ」
4. 種類：「ウェブアプリ」を選択
5. 設定：
   - **実行ユーザー**: 自分
   - **アクセスできるユーザー**: 全員
6. 「デプロイ」をクリック
7. **ウェブアプリのURL**をコピー

#### 必要な権限
初回デプロイ時に以下の権限を許可：
- ✅ Googleカレンダーへのアクセス
- ✅ Gmailでのメール送信

---

### 2. フロントエンド（main.js）の設定

#### API_BASE の更新
```javascript
// main.js 1行目
const API_BASE = 'https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec';
```
↓
```javascript
// デプロイ後に取得したURLに置き換える
const API_BASE = 'https://script.google.com/macros/s/AKfycbwPwWN7BcggcZ33ajLsobq3xY82NT8mGtXuxN86AO5PbxFEQzD-G-BskrrtlLtz_Zs/exec';
```

---

## 🧪 デプロイ後のテスト手順

### テスト1: 名前のみで予約（管理者メールのみ）

1. アプリを開く
2. **Googleログインせずに**名前を入力（例: "テスト太郎"）
3. クラスと日時を選択
4. 「予約を確定する」をクリック
5. **確認項目**:
   - ✅ `fujisaki@teraco-labo.com` にメールが届く
   - ✅ メール本文に「テスト太郎 さんの予約が予約されました。」
   - ✅ 連絡先欄がない（userEmailがないため）
   - ❌ 予約者にはメールが届かない（正常）

### テスト2: Googleログインで予約（両方にメール）

1. アプリを開く
2. **「Googleでログイン」をクリック**
3. Googleアカウントで認証
4. 名前が自動入力されることを確認
5. クラスと日時を選択
6. 「予約を確定する」をクリック
7. **確認項目**:
   - ✅ `fujisaki@teraco-labo.com` にメールが届く
   - ✅ 管理者メールに「連絡先: (ユーザーのメールアドレス)」が表示される
   - ✅ 予約者（ログインしたGoogleアカウント）にもメールが届く
   - ✅ 予約者メールに予約内容が記載されている

### テスト3: 予約キャンセル時のメール

1. 予約を確認
2. 「選択した予約を取り消す」をクリック
3. **確認項目**:
   - ✅ 管理者にキャンセル通知メールが届く
   - ✅ Googleログインユーザーの場合、予約者にもキャンセル通知が届く

---

## 🐛 トラブルシューティング

### メールが届かない場合

#### 確認1: GASの実行ログ
1. GASエディタで「実行数」をクリック
2. エラーが出ていないか確認
3. `sendSummaryMail_` が実行されているか確認

#### 確認2: Gmail設定
- 迷惑メールフォルダを確認
- `@teraco-labo.com` からのメールが受信できるか確認

#### 確認3: 権限エラー
```
Exception: このアプリはGmailへのアクセスを許可されていません
```
→ GASの「承認」画面で「Gmailでメール送信」を許可

#### 確認4: CONFIG.TEACHER_EMAIL
```javascript
if (!CONFIG.TEACHER_EMAIL) return;
```
→ 空欄の場合、メール送信がスキップされる

---

## 📊 メール通知の詳細仕様

### 管理者メールの内容

**件名**: 【TERACO予約】予約確定のお知らせ (テスト太郎様)

**本文**:
```
テスト太郎 さんの予約が予約されました。

連絡先: user@example.com  ← Googleログイン時のみ表示

件名: 【スマホ / 入門まなび(45分)】テスト太郎
日時:
・1/24(金) 10:00
・1/25(土) 14:00

カレンダー: primary
```

### 予約者メールの内容（Googleログイン時）

**件名**: 【TERACO予約】予約確定のお知らせ (テスト太郎様)

**本文**:
```
テスト太郎様

TERACOラボのご予約が予約されましたので、お知らせいたします。

件名: 【スマホ / 入門まなび(45分)】テスト太郎
日時:
・1/24(金) 10:00
・1/25(土) 14:00

ご不明な点がございましたら、お気軽にお問い合わせください。
```

---

## ✅ 最終チェックリスト

- [ ] GASをデプロイし、URLを取得した
- [ ] `main.js` の `API_BASE` を更新した
- [ ] `CONFIG.TEACHER_EMAIL` が正しく設定されている
- [ ] GASの権限（Calendar, Gmail）を承認した
- [ ] 名前のみで予約テスト完了（管理者メールのみ）
- [ ] Googleログインで予約テスト完了（両方にメール）
- [ ] キャンセル時のメール通知確認完了
- [ ] 本番環境にデプロイ完了

---

## 📞 サポート

不明点があれば、以下を確認してください：
- GASの実行ログ
- ブラウザのDevToolsコンソール
- メールの迷惑メールフォルダ
